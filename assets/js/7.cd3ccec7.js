(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{427:function(t,s,a){"use strict";a.r(s);var n=a(53),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"rack-corsを導入する"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rack-corsを導入する"}},[t._v("#")]),t._v(" rack-corsを導入する")]),t._v(" "),a("h2",{attrs:{id:"インストール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#インストール"}},[t._v("#")]),t._v(" インストール")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("% gem install rack-cors\n")])])]),a("p",[t._v("以上"),a("br"),t._v("\n詳しくは公式リポジトリのREADMEに書いてあります→"),a("a",{attrs:{href:"https://github.com/cyu/rack-cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("cyu/rack-cors"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"設定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#設定"}},[t._v("#")]),t._v(" 設定")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/perpouh/post-mortem/blob/master/server/config/initializers/cors.rb",target:"_blank",rel:"noopener noreferrer"}},[t._v("/server/config/initializers/cors.rb"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("application"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("middleware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("insert_before "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Rack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Cors")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  allow "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n    origins "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CLIENT_HOST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ← '*'のままにしない！")]),t._v("\n    resource "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      methods"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":patch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),a("p",[a("code",[t._v("ENV['CLIENT_HOST]")]),t._v(" にはDockerfileで設定したものが入ってきます。"),a("br"),t._v("\nこれでVue側からのリクエストをRailsで受けられるようになりました。")]),t._v(" "),a("p",[t._v("// TODO: localhost以外からのリクエストを弾いてくれているかはローカルだと確認しづらいので、どっかにデプロイしてから確認しようと思います。")]),t._v(" "),a("h2",{attrs:{id:"そもそもcorsとは？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#そもそもcorsとは？"}},[t._v("#")]),t._v(" そもそもCORSとは？")]),t._v(" "),a("blockquote",[a("p",[t._v("現在のWebブラウザでは、標準で同一生成元ポリシーという情報の悪用の防止策が適用されています。同一生成元ポリシーはオリジン つまりスキーム(http://, https:// など)、ホスト(example.com)、ポート(80,443)の組み合わせが全て一緒でないと情報は共有しませんというポリシーのことです。")])]),t._v(" "),a("p",[t._v("引用元: "),a("a",{attrs:{href:"https://at-virtual.net/securecoding/access-control-allow-origin%E3%81%AF%E3%81%A9%E3%82%8C%E3%81%BB%E3%81%A9%E8%84%86%E5%BC%B1%E3%81%AA%E3%81%AE%E3%81%8B%E8%84%86%E5%BC%B1%E3%81%AAcors%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%A6/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Access-Control-Allow-Origin*はどれほど脆弱なのか|脆弱なCORS設定の被害と対策を考える - @Virtual"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("※ 引用と言っておきながらホストのところを "),a("code",[t._v("example.com")]),t._v(" に書き換えています。安全のための措置です。"),a("br"),t._v("\n※ "),a("code",[t._v("example.com")]),t._v(" は開発のためにRFCによって予約されているドメインです。詳しくは検索。")]),t._v(" "),a("p",[t._v("要するにCORSはセキュリティのための機能なんですが、開発をやっているとちょいちょい面倒になる機能でもあります。今回みたいにフロントとバックエンドのポートが別のケースとか。"),a("br"),t._v("\n上でも書いたし上記のリンクにも書いてあるのですが、"),a("code",[t._v("origin")]),t._v(" は "),a("code",[t._v("'*'")]),t._v(" にしてはいけません。ファイアウォールをoffにするタイプの愚行です（それも開発環境だとやりがちだけど）")]),t._v(" "),a("p",[t._v("まあそれはそれとして「ローカルホスト同士の通信くらい良しとしてくれよめんどくせえ」と思ってはいる。")])])}),[],!1,null,null,null);s.default=r.exports}}]);