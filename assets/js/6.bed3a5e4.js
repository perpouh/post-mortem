(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{426:function(a,t,s){"use strict";s.r(t);var e=s(53),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[a._v("#")]),a._v(" Docker")]),a._v(" "),s("ul",[s("li",[a._v("Docker")]),a._v(" "),s("li",[a._v("docker-compose")])]),a._v(" "),s("h2",{attrs:{id:"構成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#構成"}},[a._v("#")]),a._v(" 構成")]),a._v(" "),s("ul",[s("li",[a._v("Rails + Vueを乗せるアプリケーションコンテナ")]),a._v(" "),s("li",[a._v("MySQLを乗せる（後でRDSとかに置き換える）データベースコンテナ")]),a._v(" "),s("li",[a._v("Nginxのプロキシコンテナ")])]),a._v(" "),s("p",[a._v("docker-compose.ymlに書いている環境変数は開発用で、本番用の値はAWSのパラメータストアとかで管理することになる。後述。")]),a._v(" "),s("h2",{attrs:{id:"バックエンドコンテナ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#バックエンドコンテナ"}},[a._v("#")]),a._v(" バックエンドコンテナ")]),a._v(" "),s("ul",[s("li",[a._v("ruby:2.6.6-alpine")])]),a._v(" "),s("h2",{attrs:{id:"フロントエンドコンテナ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#フロントエンドコンテナ"}},[a._v("#")]),a._v(" フロントエンドコンテナ")]),a._v(" "),s("p",[a._v("どうせ二箇所にルーティング書くことになるならWebpackでVueやる旨味もあんまり無いのでは？　別コンテナにした方が楽では？　という思考を起こしてこういう構成にしましたが、このときCSRF対策についての考えが漏れていたため後でちょっと悔やみました。まだまだ詰めが甘い。"),s("br"),a._v("\n昔の、CLI化する前のAngularが好きでした。jQueryを避けようとしただけでyarnとかnpmと付き合う羽目になるのあまりにもめんどい……javascript風情が……")]),a._v(" "),s("h2",{attrs:{id:"データベースコンテナ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#データベースコンテナ"}},[a._v("#")]),a._v(" データベースコンテナ")]),a._v(" "),s("ul",[s("li",[a._v("mysql:5.7.31")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("  volumes:\n    - ./containers/mysql_data:/var/lib/mysql\n")])])]),s("p",[a._v("データの永続化のためにボリュームをマウントしている。"),s("br"),a._v("\ncontainers/mysql_data下にはMySQLのスキーマやデータが含まれている。"),s("br"),a._v("\n必要な場合（複数人でデータを共有して開発を行う場合など？）はgit管理に乗せるのだと思うが、今回はいらないので.gitignoreに "),s("code",[a._v("containers/mysql_data/**/*")]),a._v(" を追加している。")]),a._v(" "),s("h2",{attrs:{id:"プロキシコンテナ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#プロキシコンテナ"}},[a._v("#")]),a._v(" プロキシコンテナ")]),a._v(" "),s("p",[a._v("ポート80(http)と443(https)からのアクセスはここにつながり、ここからアプリケーションコンテナのRailsを呼び出すことになる。"),s("br"),a._v("\n接続のためのproxy_passとかを記載した&&環境変数を埋め込んだ設定ファイルをdocker-compose.yml内でコンテナのnginx.confに上書きしている。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("envsubst '$$NGINX_SERVER_NAME $$NGINX_SERVER_PORT' < /etc/nginx/nginx.conf.template > /etc/nginx/nginx.conf\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);